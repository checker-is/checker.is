

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Burrow State &amp; Liquidation &mdash; Checker 0.1alpha documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Liquidation Auctions" href="liquidation-auction.html" />
    <link rel="prev" title="System Parameters" href="system-parameters.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Checker
          

          
          </a>

          
            
            
              <div class="version">
                0.1alpha
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="functional_spec.html">Functional Specification</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="operational.html">Operational descriptions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="system-parameters.html">System Parameters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Burrow State &amp; Liquidation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#state">State</a></li>
<li class="toctree-l3"><a class="reference internal" href="#touching">Touching</a></li>
<li class="toctree-l3"><a class="reference internal" href="#is-a-burrow-collateralized-i-e-not-overburrowed">Is a burrow collateralized (i.e. not overburrowed)?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#is-a-burrow-a-candidate-for-liquidation">Is a burrow a candidate for liquidation?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-much-collateral-should-we-liquidate">How much collateral should we liquidate?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#case-1-the-burrow-is-not-a-candidate-for-liquidation">Case 1: The burrow is not a candidate for liquidation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#case-2-the-burrow-is-a-candidate-for-liquidation">Case 2: The burrow is a candidate for liquidation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#was-the-liquidation-warranted">Was the liquidation warranted?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-if-the-liquidation-was-warranted">What if the liquidation was warranted?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#misc">Misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="liquidation-auction.html">Liquidation Auctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cfmm.html">CFMM subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deploying.html">Deploying Checker</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Checker</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="operational.html">Operational descriptions</a> &raquo;</li>
        
      <li>Burrow State &amp; Liquidation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/burrow-state-liquidations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="burrow-state-liquidation">
<h1>Burrow State &amp; Liquidation<a class="headerlink" href="#burrow-state-liquidation" title="Permalink to this headline">¶</a></h1>
<p>An operational interpretation of the burrow state and operations on it.</p>
<div class="section" id="state">
<h2>State<a class="headerlink" href="#state" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">active</span></code>: whether the burrow is supported by a creation deposit. If not,
it’s considered “inactive”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: the address of the contract holding the burrow’s collateral and
creation deposit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delegate</span></code>: the delegate for the amount of tez (collateral + creation
deposit) the burrow holds.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span></code>: the amount of tez stored in the burrow. Collateral
that has been sent to auctions <strong>does not</strong> count towards this
amount; for all we know, it’s gone forever.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outstanding_kit</span></code>: the amount of kit that is outstanding from the
burrow. This <strong>does not</strong> take into account kit we expect to receive
(to burn) from pending auctions. However, <code class="docutils literal notranslate"><span class="pre">outstanding_kit</span></code> does
increase over time, since the burrowing fee and the adjustment fee
are added to it. So, effectively, before doing anything else with a
burrow, we update its state (“touch” it, see below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">excess_kit</span></code>: additional kit stored in the burrow, when
<code class="docutils literal notranslate"><span class="pre">outstanding_kit</span></code> is zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral_at_auction</span></code>: the total amount of tez that has been sent
to auctions from this burrow, to be sold for kit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_touched</span></code>: the last time the burrow was touched.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">adjustment_index</span></code>: the last observed adjustment index (at time
<code class="docutils literal notranslate"><span class="pre">last_touched</span></code>).</p></li>
</ul>
</div>
<div class="section" id="touching">
<h2>Touching<a class="headerlink" href="#touching" title="Permalink to this headline">¶</a></h2>
<p>First thing to do before considering any of the things below is to
update the state of the burrow, by touching it. The effect of this is to</p>
<ul class="simple">
<li><p>Update the timestamp in the burrow to reflect the last time it was
touched</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_last_touched</span> <span class="o">=</span> <span class="n">now</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Re-balance
<code class="docutils literal notranslate"><span class="pre">outstanding_kit</span></code> and <code class="docutils literal notranslate"><span class="pre">excess_kit</span></code>: either <code class="docutils literal notranslate"><span class="pre">outstanding_kit</span></code> or
<code class="docutils literal notranslate"><span class="pre">excess_kit</span></code> is zero</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_outstanding_kit</span> <span class="o">=</span> <span class="n">old_outstanding_kit</span> <span class="o">-</span> <span class="nb">min</span> <span class="n">old_outstanding_kit</span> <span class="n">old_excess_kit</span>
<span class="n">new_excess_kit</span>      <span class="o">=</span> <span class="n">old_excess_kit</span>      <span class="o">-</span> <span class="nb">min</span> <span class="n">old_outstanding_kit</span> <span class="n">old_excess_kit</span>
</pre></div>
</div>
<ul class="simple">
<li><p>To add accrued burrow and adjustment fee to its outstanding kit</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>new_outstanding = old_outstanding * (new_adjustment_index / old_adjustment_index)``
</pre></div>
</div>
<p>Note that if the current timestamp is identical to that stored in the burrow,
we do not perform any of the above.</p>
<p>Each of the following operations implicitly touch the burrow (i.e., perform the
above updates) before doing anything else.</p>
</div>
<div class="section" id="is-a-burrow-collateralized-i-e-not-overburrowed">
<h2>Is a burrow collateralized (i.e. not overburrowed)?<a class="headerlink" href="#is-a-burrow-collateralized-i-e-not-overburrowed" title="Permalink to this headline">¶</a></h2>
<p>The burrow is considered collateralized if the following holds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">collateral</span> <span class="o">&gt;=</span> <span class="n">outstanding</span> <span class="o">*</span> <span class="n">fminting</span> <span class="o">*</span> <span class="n">current_minting_price</span>      <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">collateral</span></code> here refers to the amount of tez stored in the burrow
(collateral that has been sent to auctions <strong>does not</strong> count towards
this amount; for all we know, it’s gone forever).</p>
<p><code class="docutils literal notranslate"><span class="pre">outstanding_kit</span></code> here refers to the accrued amount of kit that is
outstanding from the burrow (kit we expect to receive from pending
auctions <strong>is not</strong> considered burned here, but still outstanding).</p>
</div>
<div class="section" id="is-a-burrow-a-candidate-for-liquidation">
<h2>Is a burrow a candidate for liquidation?<a class="headerlink" href="#is-a-burrow-a-candidate-for-liquidation" title="Permalink to this headline">¶</a></h2>
<p>The burrow cannot be marked for liquidation if the following holds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">collateral</span> <span class="o">&gt;=</span> <span class="n">optimistic_outstanding</span> <span class="o">*</span> <span class="n">fliquidation</span> <span class="o">*</span> <span class="n">liquidation_price</span>      <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">collateral</span></code> here refers to the amount of tez stored in the burrow
(collateral that has been sent to auctions <strong>does not</strong> count towards
this amount; for all we know, it’s gone forever).</p>
<p><code class="docutils literal notranslate"><span class="pre">outstanding_kit</span></code> here refers to the accrued amount of kit that is
outstanding from the burrow. In this case we optimistically <strong>do take
into account</strong> kit we expect to receive from pending auctions at the
<code class="docutils literal notranslate"><span class="pre">current_minting_price</span></code>, but pessimistically assume that these pending
auctions are warranted (so we lose the liquidation penalty). That is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optimistic_outstanding</span> <span class="o">=</span> <span class="n">outstanding</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidation_penalty</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">collateral_at_auction</span> <span class="o">/</span> <span class="n">current_minting_price</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-much-collateral-should-we-liquidate">
<h2>How much collateral should we liquidate?<a class="headerlink" href="#how-much-collateral-should-we-liquidate" title="Permalink to this headline">¶</a></h2>
<p>In general, in order to calculate how much should we auction off we
assume that a) this auction is warranted, b) all pending auctions are
also warranted, c) the price we’ll get for everything is
<code class="docutils literal notranslate"><span class="pre">current_minting_price</span></code>. a) and b) effectively mean that we can only
expect <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">-</span> <span class="pre">liquidation_penalty)</span></code> returns from all auctions
considered. Formally:</p>
<ul>
<li><p>First, from auctioning we expect to get the current
<code class="docutils literal notranslate"><span class="pre">minting_price</span></code>, so, if we send <code class="docutils literal notranslate"><span class="pre">tez_to_auction</span></code> and
<code class="docutils literal notranslate"><span class="pre">repaid_kit</span></code> is received, we have</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tez_to_auction</span> <span class="o">=</span> <span class="n">repaid_kit</span> <span class="o">*</span> <span class="n">minting_price</span>                   <span class="o">&lt;=&gt;</span>
<span class="n">repaid_kit</span> <span class="o">=</span> <span class="n">tez_to_auction</span> <span class="o">/</span> <span class="n">minting_price</span>                   <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Second, we assume that the auction is warranted (so we lose the
liquidation penalty), thus</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">actual_repaid_kit</span> <span class="o">=</span> <span class="n">repaid_kit</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidation_penalty</span><span class="p">)</span>    <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Third, we consider all pending auctions to be successful, using the
current <code class="docutils literal notranslate"><span class="pre">minting_price</span></code>, but also warranted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optimistic_outstanding</span> <span class="o">=</span> <span class="n">outstanding_kit</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidation_penalty</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">collateral_at_auction</span> <span class="o">/</span> <span class="n">minting_price</span><span class="p">)</span>       <span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Fourth, under the above conditions we aim to bring the burrow into a
state where it’s not oveburrowed anymore, thus</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">collateral</span> <span class="o">-</span> <span class="n">tez_to_auction</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">optimistic_outstanding</span> <span class="o">-</span> <span class="n">actual_repaid_kit</span><span class="p">)</span> <span class="o">*</span> <span class="n">fminting</span> <span class="o">*</span> <span class="n">minting_price</span>    <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Solving <code class="docutils literal notranslate"><span class="pre">(3)</span></code>, <code class="docutils literal notranslate"><span class="pre">(4)</span></code>, <code class="docutils literal notranslate"><span class="pre">(5)</span></code>, and <code class="docutils literal notranslate"><span class="pre">(6)</span></code> the above gives us
<code class="docutils literal notranslate"><span class="pre">(7)</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tez_to_auction</span> <span class="o">&gt;=</span>
  <span class="p">(</span> <span class="n">outstanding_kit</span> <span class="o">*</span> <span class="n">fminting</span> <span class="o">*</span> <span class="n">minting_price</span>
  <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidation_penalty</span><span class="p">)</span> <span class="o">*</span> <span class="n">fminting</span> <span class="o">*</span> <span class="n">collateral_at_auction</span>
  <span class="o">-</span> <span class="n">collateral</span>
  <span class="p">)</span>
  <span class="o">/</span>
  <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidation_penalty</span><span class="p">)</span> <span class="o">*</span> <span class="n">fminting</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>if <code class="docutils literal notranslate"><span class="pre">((1</span> <span class="pre">-</span> <span class="pre">liquidation_penalty)</span> <span class="pre">*</span> <span class="pre">fminting</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>.</p>
<p>Say the burrow has been touched and all its parameters are up to date.
Concerning liquidation, we have the following cases:</p>
<div class="section" id="case-1-the-burrow-is-not-a-candidate-for-liquidation">
<h3>Case 1: The burrow is not a candidate for liquidation<a class="headerlink" href="#case-1-the-burrow-is-not-a-candidate-for-liquidation" title="Permalink to this headline">¶</a></h3>
<p>If (2) above holds then the burrow should not be liquidated. Send
nothing to auctions and leave the burrow as is.</p>
</div>
<div class="section" id="case-2-the-burrow-is-a-candidate-for-liquidation">
<h3>Case 2: The burrow is a candidate for liquidation<a class="headerlink" href="#case-2-the-burrow-is-a-candidate-for-liquidation" title="Permalink to this headline">¶</a></h3>
<p>If (2) above does not hold, then the burrow should be liquidated. Either
partially, completely, or even be closed.</p>
<p>First things first, the actor who initiated liquidation should get their
reward (burrow creation deposit + percentage of collateral):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">liquidation_reward</span> <span class="o">=</span> <span class="n">creation_deposit</span> <span class="o">+</span> <span class="p">(</span><span class="n">collateral</span> <span class="o">*</span> <span class="n">liquidation_reward_percentage</span><span class="p">)</span>
</pre></div>
</div>
<p>That is, before we compute anything else, we leave the burrow with less
collateral and without a creation deposit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">active</span>     <span class="o">=</span> <span class="n">false</span>
<span class="n">collateral</span> <span class="o">=</span> <span class="n">collateral</span> <span class="o">-</span> <span class="p">(</span><span class="n">collateral</span> <span class="o">*</span> <span class="n">liquidation_reward_percentage</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, depending on how much collateral remains, we have the following
cases:</p>
<div class="section" id="case-2a-collateral-creation-deposit">
<h4>Case 2A: <code class="docutils literal notranslate"><span class="pre">collateral</span> <span class="pre">&lt;</span> <span class="pre">creation_deposit</span></code><a class="headerlink" href="#case-2a-collateral-creation-deposit" title="Permalink to this headline">¶</a></h4>
<p>We cannot replenish the creation deposit.</p>
<ul class="simple">
<li><p>We send all the remaining collateral to be auctioned off for kit.</p></li>
<li><p>The burrow remains deactivated.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">collateral</span>            <span class="o">=</span> <span class="mi">0</span>
<span class="n">collateral_at_auction</span> <span class="o">=</span> <span class="n">collateral_at_auction</span> <span class="o">+</span> <span class="n">tez_to_auction</span>
</pre></div>
</div>
</div>
<div class="section" id="case-2b-collateral-creation-deposit">
<h4>Case 2B: <code class="docutils literal notranslate"><span class="pre">collateral</span> <span class="pre">&gt;=</span> <span class="pre">creation_deposit</span></code><a class="headerlink" href="#case-2b-collateral-creation-deposit" title="Permalink to this headline">¶</a></h4>
<p>We can replenish the creation deposit, and this is the first thing we
do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">collateral</span> <span class="o">=</span> <span class="n">collateral</span> <span class="o">-</span> <span class="n">creation_deposit</span>
</pre></div>
</div>
<p>Now all that remains is to compute what should we auction off to bring
the burrow to a state where <em>“any outstanding kits could have just been
minted”</em>. For that, we use the <code class="docutils literal notranslate"><span class="pre">(7)</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tez_to_auction</span> <span class="o">=</span> <span class="n">ceil</span> <span class="p">(</span>
  <span class="p">(</span> <span class="n">outstanding_kit</span> <span class="o">*</span> <span class="n">fminting</span> <span class="o">*</span> <span class="n">minting_price</span>
  <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidation_penalty</span><span class="p">)</span> <span class="o">*</span> <span class="n">fminting</span> <span class="o">*</span> <span class="n">collateral_at_auction</span>
  <span class="o">-</span> <span class="n">collateral</span>
  <span class="p">)</span>
  <span class="o">/</span>
  <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidation_penalty</span><span class="p">)</span> <span class="o">*</span> <span class="n">fminting</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p>If <code class="docutils literal notranslate"><span class="pre">tez_to_auction</span> <span class="pre">&lt;</span> <span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">tez_to_auction</span> <span class="pre">&gt;</span> <span class="pre">collateral</span></code>, then
restoration is impossible: liquidate the entire remaining collateral
(Note that the resulting burrow can be targeted for liquidation one
last time (with the creation deposit being the only reward).
Alternatively, we could (rather harshly) liquidate the deposit too
and close the burrow.):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">active</span>                <span class="o">=</span> <span class="n">true</span>
<span class="n">collateral</span>            <span class="o">=</span> <span class="mi">0</span>
<span class="n">collateral_at_auction</span> <span class="o">=</span> <span class="n">collateral_at_auction</span> <span class="o">+</span> <span class="n">collateral</span>
</pre></div>
</div>
</li>
<li><p>Otherwise auction off exactly <code class="docutils literal notranslate"><span class="pre">tez_to_auction</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">active</span>                <span class="o">=</span> <span class="n">true</span>
<span class="n">collateral</span>            <span class="o">=</span> <span class="n">collateral</span> <span class="o">-</span> <span class="n">tez_to_auction</span>
<span class="n">collateral_at_auction</span> <span class="o">=</span> <span class="n">collateral_at_auction</span> <span class="o">+</span> <span class="n">tez_to_auction</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="was-the-liquidation-warranted">
<h2>Was the liquidation warranted?<a class="headerlink" href="#was-the-liquidation-warranted" title="Permalink to this headline">¶</a></h2>
<p>We sent 10% extra tez to be auctioned off as a penalty, but in case the
actual selling price of the tez would not have triggered a liquidation
(retrospectively), we wish to bring that back to the burrow, if
possible.</p>
<p>Calculations: In order to see whether liquidation should occur, we used
equation (2) above, which we can rewrite as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">liquidation_price</span> <span class="o">&lt;=</span> <span class="n">collateral</span> <span class="o">/</span> <span class="p">(</span><span class="n">optimistic_outstanding</span> <span class="o">*</span> <span class="n">fliquidation</span><span class="p">)</span>    <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>So, if (3) was satisfied, we wouldn’t have triggered a liquidation. If
we assume that at the end we sent <code class="docutils literal notranslate"><span class="pre">tez_to_auction</span></code> to be auctioned off
and we received <code class="docutils literal notranslate"><span class="pre">repaid_kit</span></code> for it, we have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maximum_non_liquidating_price</span> <span class="o">=</span> <span class="n">collateral</span> <span class="o">/</span> <span class="p">(</span><span class="n">optimistic_outstanding</span> <span class="o">*</span> <span class="n">fliquidation</span><span class="p">)</span>
<span class="n">real_price</span>                    <span class="o">=</span> <span class="n">tez_to_auction</span> <span class="o">/</span> <span class="n">repaid_kit</span>    <span class="c1"># derived from the auction outcome</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">real_price</span> <span class="pre">&lt;=</span> <span class="pre">maximum_non_liquidating_price</span></code> then the liquidation
was not warranted (i.e. the liquidation price we used when calculating
<code class="docutils literal notranslate"><span class="pre">tez_to_auction</span></code> was off) and we wish to return the kit we received
from the auction in its entirety to the burrow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">real_price</span> <span class="o">&lt;=</span> <span class="n">maximum_non_liquidating_price</span>
<span class="n">tez_to_auction</span> <span class="o">/</span> <span class="n">repaid_kit</span> <span class="o">&lt;=</span> <span class="n">collateral</span> <span class="o">/</span> <span class="p">(</span><span class="n">fliquidation</span> <span class="o">*</span> <span class="n">optimistic_outstanding</span><span class="p">)</span> <span class="o">&lt;=&gt;</span>
<span class="n">tez_to_auction</span> <span class="o">*</span> <span class="p">(</span><span class="n">fliquidation</span> <span class="o">*</span> <span class="n">optimistic_outstanding</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">repaid_kit</span> <span class="o">*</span> <span class="n">collateral</span> <span class="o">&lt;=&gt;</span>
<span class="n">tez_to_auction</span> <span class="o">*</span> <span class="p">(</span><span class="n">fliquidation</span> <span class="o">*</span> <span class="n">optimistic_outstanding</span><span class="p">)</span> <span class="o">/</span> <span class="n">collateral</span> <span class="o">&lt;=</span> <span class="n">repaid_kit</span> <span class="o">&lt;=&gt;</span>
<span class="n">repaid_kit</span> <span class="o">&gt;=</span> <span class="n">tez_to_auction</span> <span class="o">*</span> <span class="p">(</span><span class="n">fliquidation</span> <span class="o">*</span> <span class="n">optimistic_outstanding</span><span class="p">)</span> <span class="o">/</span> <span class="n">collateral</span>
</pre></div>
</div>
<p>So, if the kit that the auction yields is more than</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">min_received_kit_for_unwarranted</span> <span class="o">=</span> <span class="n">tez_to_auction</span> <span class="o">*</span> <span class="p">(</span><span class="n">fliquidation</span> <span class="o">*</span> <span class="n">optimistic_outstanding</span><span class="p">)</span> <span class="o">/</span> <span class="n">collateral</span>
</pre></div>
</div>
<p>then this liquidation was unwarranted.</p>
</div>
<div class="section" id="what-if-the-liquidation-was-warranted">
<h2>What if the liquidation was warranted?<a class="headerlink" href="#what-if-the-liquidation-was-warranted" title="Permalink to this headline">¶</a></h2>
<p>When we send <code class="docutils literal notranslate"><span class="pre">tez_to_auction</span></code> to an auction, we also send
<code class="docutils literal notranslate"><span class="pre">min_received_kit_for_unwarranted</span></code> so that—after the auction is
over—we can determine whether it was warranted. If it was warranted,
then we wish to return the received kit in its entirety to the burrow.
Otherwise we burn 10% of the kit earnings.</p>
<p>The auction logic might end up splitting <code class="docutils literal notranslate"><span class="pre">tez_to_auction</span></code> into parts
(slices) that can be sold for different prices; we perform the above
check per slice.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tez_to_auction</span> <span class="o">=</span> <span class="n">tez_1</span> <span class="o">+</span> <span class="n">tez_2</span> <span class="o">+</span> <span class="o">...</span> <span class="o">+</span> <span class="n">tez_n</span>
</pre></div>
</div>
<p>If we end up selling slice <code class="docutils literal notranslate"><span class="pre">tez_i</span></code> for <code class="docutils literal notranslate"><span class="pre">kit_i</span></code>, this part of the
liquidation is considered unwarranted (and thus <code class="docutils literal notranslate"><span class="pre">kit_i</span></code> is returned to
the burrow) only if</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kit_i</span> <span class="o">&gt;=</span> <span class="n">min_received_kit_for_unwarranted</span> <span class="o">*</span> <span class="p">(</span><span class="n">tez_i</span> <span class="o">/</span> <span class="n">tez_to_auction</span><span class="p">)</span> <span class="o">&lt;=&gt;</span>
<span class="n">tez_to_auction</span> <span class="o">*</span> <span class="n">kit_i</span> <span class="o">&gt;=</span> <span class="n">min_received_kit_for_unwarranted</span> <span class="o">*</span> <span class="n">tez_i</span>
</pre></div>
</div>
</div>
<div class="section" id="misc">
<h2>Misc<a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fminting</span> <span class="pre">&gt;</span> <span class="pre">fliquidation</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">minting_price</span> <span class="pre">&gt;=</span> <span class="pre">liquidation_price</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">liquidation_penalty</span> <span class="pre">=</span> <span class="pre">10%</span></code></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="liquidation-auction.html" class="btn btn-neutral float-right" title="Liquidation Auctions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="system-parameters.html" class="btn btn-neutral float-left" title="System Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Nomadic Labs / Tweag.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>